#@type:grammar;@schema:procedure;
GRAMMAR_PARSE{
TOKENS:
NAME:=[A-Z][A-Z0-9_]{0,19}
COND:=[A-Z0-9_]+
VERB:=EMIT_CHAT|EMIT_LOG|EMIT_CTX|HALT|CONTINUE|RETRY|REQUIRE|ASSERT|WARN|ERROR|DENY|SET|CLEAR|PUSH_STATE|POP_STATE|CALL_TOOL|DELEGATE|SAVE_PROJECT|SET_DOMAIN
MSG:="\""[\\x20-\\x7E]*"\""
ARROW:="->"
SEMI:=";"
LBRACE:="{"
RBRACE:="}"
COLON:=":"
COMMA:=","
NL:="\n"
LEXER:IGNORE(" "|"\\t"|"\r")REQUIRE(NL)FORBID(COMMENTS)
STRUCTURE:
FILE:=(BLOCK NL*)+
BLOCK:=NAME LBRACE NL PRECONDITION_LINE ACTION_SECTION STATE_LINE RBRACE NL
PRECONDITION_LINE:="PRECONDITION"COLON COND NL
ACTION_SECTION:="ACTION"COLON NL ACTION_RULE+
ACTION_RULE:="IF"COND ARROW VERB ACTION_ARG_OPT SEMI NL
ACTION_ARG_OPT:=Îµ|NAME|MSG|NAME MSG
STATE_LINE:="STATE"COLON LBRACE STATE_LIST RBRACE NL
STATE_LIST:=NAME(COMMA NAME)*
CONSTRAINTS:
C1:ONE_RULE_PER_LINE
C2:NL_REQUIRED_AFTER_ALL_RULES
C3:VERB_NAME_COND_UPPERCASE
C4:MSG_ASCII_SINGLELINE
C5:NO_EXTRA_CONTENT
C6:NO_COMMENTS
SEMANTICS:
S1:TOP_TO_BOTTOM_EVAL
S2:MULTIPLE_TRUE_EXECUTES_ALL
S3:NO_IMPLICIT_ELSE
S4:ON_PARSE_FAIL->ERROR(BLOCK,LINE)
DETERMINISM:
D1:IGNORE_WS
D2:NL_BOUNDARIES_AUDIT
D3:ONE_RULE_PER_LINE_ISOLATION
}
