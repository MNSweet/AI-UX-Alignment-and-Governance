#@type:grammar;@schema:reference
REQUIRE_FILE{
PRECONDITION : START
ACTION :
	/* 1) Check current thread uploads */
	IF TRUE -> CALL_TOOL "file_search.msearch{queries:['hail_latest.grammar','hail_latest.json'], source_filter:['files_uploaded_in_conversation']}" ;
	IF TOOL_RESULT_FOUND -> SET "FILE_PRESENT" ;
	IF TOOL_RESULT_FOUND -> SET "SRC={tool.file_path}" ;
	IF TOOL_RESULT_FOUND -> SET "VER={tool.meta.version|00w01}" ;
	IF !FILE_PRESENT -> CALL_TOOL "file_search.msearch{queries:['HAIL_LATEST','hail_latest.grammar','hail_latest.json'], source_filter:['slurm_google_drive']}" ;
	IF TOOL_RESULT_FOUND -> SET "FILE_PRESENT" ;
	IF TOOL_RESULT_FOUND -> SET "SRC={tool.file_url}" ;
	IF TOOL_RESULT_FOUND -> SET "VER={tool.meta.version|00w01}" ;
	IF !FILE_PRESENT -> SET "FILE_MISSING" ;
	IF FILE_MISSING -> HALT ;
	IF FILE_PRESENT -> CONTINUE ;
STATE : { DOMAINS=THREAD|CONNECTORS ; EXPORTS=FILE_PRESENT|FILE_MISSING|SRC|VER }
}
